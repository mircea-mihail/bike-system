C51 COMPILER V9.00   I2C                                                                   09/22/2012 11:56:53 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\obj\I2C.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\I2C.c BROWSE INCDIR(.\inc) DEBUG OBJECTEXTEND PRINT(.\obj\I2C.lst) O
                    -BJECT(.\obj\I2C.obj)

line level    source

   1          /*******************************************************************************
   2          *  Copyright (C) 2010 - All Rights Reserved             
   3          * хМ╪ЧвВуъ:     фО╥и╪рвЕ
   4          * ╟Фх╗кЫсп: фО╥и╣Гвс    
   5          * ╢╢╫╗хуфз:     2010дЙ6тб10ху 
   6          * хМ╪ЧюЗй╥:     2011дЙ2тб10хупч╦д
   7                      2012дЙ9тб20хутыпч╦д
   8          * Version:  3.5 
   9          * Demo лт╠╕╣ьж╥ё╨http://qifeidz.taobao.com/
  10          **********************************************************************************************************
             -************************************
  11          юаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюа
             -юаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюа
  12          юаюаюаюаюаюаюаюаюаюаюар╩юаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаю╖р╩юаюаюаюаюаюаюаюаюаюа
             -юаюаюаюар╩р╩р╩р╩р╩р╩р╩юаюаюаюаюаюаюа
  13          юаюаю╖р╩р╩р╩р╩юар╩р╩р╩р╩р╩р╩╤Чюаюаюаюаю╖р╩р╩р╩р╩р╩р╩р╩р╩юаюаюаюаюаюаюаюаюакд┘√юаюар╩р╩юаюаюар╩юаюаюаюаюаюа
             -юаюаюар╩р╩р╩р╩кдкдр╩р╩р╩юаюаюаюаюаюа
  14          юаюаюаюаюаюар╩юаюаюар╩╤Чр╩юаюаюаюаюаюар╩р╩р╩р╩кд┘√╤Чр╩кдюар╩р╩юаюаюаюаюакдр╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩юаюаюаюаюа
             -юаюаюакдюаюакдр╩р╩р╩р╩┘√юаюаюаюаюаюа
  15          юаюаюакд┘√┘√р╩юаюа┘√юаюаюакдюаюаюаюаюаюаюаюаюаюаюаю╖р╩юар╩р╩юаюаюаюаюаюаюар╩р╩┘√┘√р╩р╩┘√┘√┘√р╩р╩юаюаюаюаюа
             -юа┘√┘√┘√┘√┘√┘√р╩р╩┘√┘√┘√юаюаюаюаюаюа
  16          юаюаюар╩юа╤Чр╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩юаюаюаюаюаюаюаюа╤Чр╩р╩ю╖юаюаюаюаюаюаюаюар╩р╩р╩р╩р╩р╩р╩р╩р╩р╩кдюаюаюаюаюа
             -р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩р╩юаюаюа
  17          юаюаюар╩р╩р╩р╩р╩┘√╤Чр╩р╩┘√р╩юа┘√юаюаюаюаюаюаюаюаюар╩р╩р╩р╩р╩юаюаюаюаюаюаюар╩р╩юаюар╩р╩юаюаюар╩ю╖юаюаюаюаюа
             -р╩р╩кдюаюаюаюар╩р╩юаюаю╖р╩р╩кдюаюаюа
  18          юаюаюаюаюаюаюар╩ю╖р╩юар╩┘√р╩юаюаюаюаюаюаюаюаюаюаюаю╖р╩юаюар╩р╩юаюаюаюаюаюар╩р╩р╩р╩р╩р╩р╩р╩р╩р╩┘√юаюаюаюаюа
             -юаюаюаюаюаюаюар╩р╩┘√юаюаюаюаюаюаюаюа
  19          юа╤Чр╩р╩р╩юакдю╖┘√р╩р╩р╩┘√р╩юаюаюаюаюаюаюаюаюаюаюаюар╩р╩юаюаюаюаюаюаюаюаюаюаюаюаюакдр╩┘√юаюаюаюаюаюар╩юаюа
             -юаюаюаюаюаюаюар╩р╩┘√юаюаюаюаюаюаюаюа
  20          юаюаюаюаюаюар╩юаюаюаюаюар╩р╩юаюаюаюаюаюаюаюаюаюаюаюа┘√р╩р╩р╩р╩р╩р╩ю╖юаюаюаюаюаюаюаюар╩р╩р╩р╩р╩р╩р╩р╩р╩юаюа
             -юаюаюаю╖юаюа┘√р╩р╩юаюаюаюаюаюаюаюаюа
  21          юаюаюаюар╩р╩р╩юаюаю╖р╩р╩р╩р╩юаюаюаюаюаюаюаюаюаюаюаюаюаюар╩р╩р╩р╩р╩юаюаюаюаюаюаюаюаюаюар╩р╩р╩р╩р╩р╩р╩юаюаюа
             -юаюаюаюар╩р╩р╩р╩кдюаюаюаюаюаюаюаюаюа
  22          юаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюа
             -юаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюаюа
  23          **********************************************************************************************************
             -************************************/
  24          #include<C8051F340.h>
  25          #include<delay.h>
  26          
  27          #define SDA_IN0()               {P0MDOUT= 0X00;}
  28          #define SDA_OUT0()              {P0MDOUT= 0XFF;}
  29          
  30          
  31          sbit I2C_SCL0=P0^2;
  32          sbit I2C_SDA0=P0^1;
  33          sbit SDA_STATE0=P0^1;
  34          
  35          
  36          void InitI2C0(void)
  37          {
  38   1              P0MDIN |= 0X06;
  39   1              P0MDOUT|= 0X06;
  40   1      }
C51 COMPILER V9.00   I2C                                                                   09/22/2012 11:56:53 PAGE 2   

  41          
  42          void StartI2C0(void)
  43          {
  44   1              I2C_SDA0=1;    
  45   1          delay_us(100);
  46   1      
  47   1          I2C_SCL0=1;    
  48   1          delay_us(100);
  49   1       
  50   1          I2C_SDA0=0;
  51   1          delay_us(100);
  52   1      
  53   1          I2C_SCL0=0;  
  54   1          delay_us(100);
  55   1      
  56   1      
  57   1      }
  58          
  59          void StopI2C0(void)
  60          {
  61   1              I2C_SDA0=0;
  62   1          delay_us(100);
  63   1       
  64   1          I2C_SCL0=1;
  65   1          delay_us(100);  
  66   1      
  67   1          I2C_SDA0=1;
  68   1          delay_us(100);
  69   1       
  70   1      
  71   1      }
  72          
  73          
  74          void NoAck0(void)
  75          {
  76   1              
  77   1              I2C_SDA0=1;
  78   1              delay_us(100);
  79   1              
  80   1              I2C_SCL0=1;
  81   1              delay_us(100);
  82   1              
  83   1              I2C_SCL0=0;
  84   1              delay_us(100);
  85   1              
  86   1              I2C_SDA0=0;
  87   1              delay_us(100);
  88   1      
  89   1      }
  90          
  91          
  92          unsigned char I2CWrite0(unsigned char DData)
  93          {
  94   1              unsigned char j,tem;
  95   1      
  96   1              for(j=0;j<8;j++) 
  97   1              {
  98   2                      if((DData<<j)&0x80)
  99   2                      {
 100   3                              I2C_SDA0=1;
 101   3                      }
 102   2                      else
C51 COMPILER V9.00   I2C                                                                   09/22/2012 11:56:53 PAGE 3   

 103   2                      {
 104   3                              I2C_SDA0=0;
 105   3                      }
 106   2                      delay_us(100);
 107   2                      I2C_SCL0=1;
 108   2                      delay_us(100);
 109   2                      I2C_SCL0=0;;
 110   2                      delay_us(100);
 111   2      
 112   2              }
 113   1              delay_us(100);
 114   1              
 115   1              SDA_IN0();
 116   1              delay_us(100);
 117   1              I2C_SCL0=1;
 118   1              delay_us(1000);
 119   1              if(SDA_STATE0==1)
 120   1              {
 121   2                      tem=0;  
 122   2              }
 123   1              else
 124   1              {
 125   2                      tem=1;   
 126   2              }
 127   1              I2C_SCL0=0;
 128   1              delay_us(100);  
 129   1          SDA_OUT0();
 130   1      
 131   1              return(tem);  
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    218    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
